# Цели элитных скриптов

Цели являются центральной частью элитных скриптов и необходимы для работы действий и зон.

## Типы целей

Типы целей определяют, какие сущности или местоположения становятся целями скрипта.

| Тип цели                     |                                      Детали                                       |                                                                                        Особенности                                                                                        |
|------------------------------|:---------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| `NEARBY_PLAYERS`             |   Игроки в [радиусе]($language$/elitemobs/elitescript_targets.md&section=range)   |                                                      Требуется [`range`]($language$/elitemobs/elitescript_targets.md&section=range)                                                       |
| `NEARBY_MOBS`                |    Мобы в [радиусе]($language$/elitemobs/elitescript_targets.md&section=range)    |                                                      Требуется [`range`]($language$/elitemobs/elitescript_targets.md&section=range)                                                       |
| `WORLD_PLAYERS`              |                                   Игроки в мире                                   |                                                                                             ❌                                                                                             |
| `ALL_PLAYERS`                |                                 Игроки на сервере                                 |                                                                                             ❌                                                                                             |
| `DIRECT_TARGET`              |                                 Игроки в событии                                  |                                                        [Требуется совместимое событие]($language$/elitemobs/elitescript_events.md)                                                        |
| `SELF`                       |                       Элитный моб, использующий способность                       |                                                                                             ❌                                                                                             |
| `SELF_SPAWN`                 |                         Целится на место появления босса                          |                                                                                             ❌                                                                                             |
| `LOCATION`                   |                             Конкретное местоположение                             |                                                   Требуется [`location`]($language$/elitemobs/elitescript_targets.md&section=location)                                                    |
| `LOCATIONS`                  |                        Несколько конкретных местоположений                        |                                                  Требуется [`locations`]($language$/elitemobs/elitescript_targets.md&section=locations)                                                   |
| `ZONE_FULL`                  |                                Целится внутрь зоны                                |                                                               Требуется [`Zone`]($language$/elitemobs/elitescript_zones.md)                                                               |
| `ZONE_BORDER`                |                              Целится на границу зоны                              |                                                               Требуется [`Zone`]($language$/elitemobs/elitescript_zones.md)                                                               |
| `ACTION_TARGET`              |                            Наследует цели от действия.                            | **Может использоваться только для [условий]($language$/elitemobs/elitescript_conditions.md) действия и [Относительных векторов]($language$/elitemobs/elitescript_relative_vectors.md)!!** |
| `LANDING_LOCATION`           |                         Целится на место, куда упал блок.                         |                      **Может использоваться только для действия [`SPAWN_FALLING_BLOCK`]($language$/elitemobs/elitescript_actions.md&section=spawn_falling_block)!**                       |
| `INHERIT_SCRIPT_TARGET`      |             Наследует цель от скрипта, который запускает этот скрипт              |                                                              Может работать, только если скрипт был вызван другим скриптом!                                                               |
| `INHERIT_SCRIPT_ZONE_FULL`   |   Целится внутрь зоны, унаследованной от скрипта, который запускает этот скрипт   |                                        Требуется [`Zone`]($language$/elitemobs/elitescript_zones.md) **в скрипте, который вызывает этот скрипт!**                                         |
| `INHERIT_SCRIPT_ZONE_BORDER` | Целится на границу зоны, унаследованной от скрипта, который запускает этот скрипт |                                        Требуется [`Zone`]($language$/elitemobs/elitescript_zones.md) **в скрипте, который вызывает этот скрипт!**                                         |

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  Example:
    Events:
    - EliteMobDeathEvent
    Actions:
      - action: MESSAGE
        Target:
          targetType: ALL_PLAYERS
        sValue: "&2Привет, мир!"
```

Это отправляет сообщение цели. Поскольку целью установлено `ALL_PLAYERS`, оно отправит это сообщение всем игрокам
онлайн.

</div>

</details>

</div>

---

## Общие атрибуты

Следующие настройки могут быть применены ко всем целям.

| Значения |                     Детали                      |             Особенности             |
|----------|:-----------------------------------------------:|:-----------------------------------:|
| `offset` | Устанавливает смещение для местоположения цели. | Не может быть нацелено на сущности! |

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  Example:
    Events:
    - EliteMobDeathEvent
    Actions
    - action: STRIKE_LIGHTNING
      Target:
        targetType: SELF
        offset: "0,2,0"
```

Это ударяет молнией на 2 блока выше босса. Обратите внимание, что STRIKE_LIGHTNING использует местоположения и не влияет
на сущности, поэтому может иметь смещения.

Вы не можете установить смещение для отправки сообщения, поскольку сообщения отправляются игрокам. Однако вы можете
установить смещение для зоны, которая затем может нацеливаться на сущности.

</div>

</details>

</div>

---

## range

Устанавливает радиус сканирования для поиска игроков поблизости в типе цели `NEARBY_PLAYERS`.

| Значения |                            Детали                             | По умолчанию |
|----------|:-------------------------------------------------------------:|:------------:|
| `range`  | Устанавливает радиус в блоках для сканирования целей игроков. |    `20.0`    |

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  Example:
    Events:
    - EliteMobDeathEvent
    Actions:
      - action: MESSAGE
        Target:
          targetType: NEARBY_PLAYERS
          range: 25.0
        sValue: "&2Цели для игроков в радиусе 25 блоков!"
```

Это отправляет сообщение игрокам в радиусе 25 блоков от босса, когда босс умирает.

</div>

</details>

</div>

## location

Устанавливает местоположение для типа цели `LOCATION`.

| Значения   |                          Детали                           | По умолчанию |
|------------|:---------------------------------------------------------:|:------------:|
| `location` | Устанавливает местоположение в мире, которое будет целью. |    `none`    |

Здесь используется формат `location: worldname,x,y,z,pitch,yaw` для местоположения.

**Обратите внимание, что `same_as_boss` является допустимым заполнителем для имени мира, например, `same_as_boss,100,64,100,0,0` будет допустимым местоположением, которое будет нацелено на тот же мир, где находится босс.**

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  Example:
    Events:
    - EliteMobDeathEvent
    Actions
    - action: STRIKE_LIGHTNING
      Target:
        targetType: LOCATION
        location: "myWorld,100,64,200,0,0"
```

Это создает удар молнии в местоположении x=100, y=64, z=200 мира под названием `myWorld`.

</div>

</details>

</div>

---

## locations

Устанавливает местоположения для типа цели `LOCATIONS`.

| Значения    |                              Детали                               | По умолчанию |
|-------------|:-----------------------------------------------------------------:|:------------:|
| `locations` | Устанавливает список местоположений в мире, которые будут целями. |    `none`    |

Здесь используется формат `worldname,x,y,z,pitch,yaw` для местоположения.

**Обратите внимание, что `same_as_boss` является допустимым заполнителем для имени мира, например, `same_as_boss,100,64,100,0,0` будет допустимым местоположением, которое будет нацелено на тот же мир, где находится босс.**

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  Example:
    Events:
    - EliteMobDeathEvent
    Actions
    - action: STRIKE_LIGHTNING
      Target:
        targetType: LOCATIONS
        locations:
        - "myWorld,100,64,200,0,0"
        - "same_as_boss,-100,12,130,0,0"
```

Это создает удар молнии в местоположении x=100, y=64, z=200 мира под названием `myWorld` и другой удар молнии в том же
мире, что и босс, в местоположении x=-100, y=12 и z=130.

</div>

</details>

</div>

---

## Нацеливание на зоны

[Зоны]($language$/elitemobs/elitescript_zones.md) имеют несколько целей, и важно понимать, как они работают, чтобы
использовать Elite Scripting в полной мере.

Зоны работают в двух частях:

### Часть 1 - Настройка, куда идет зона

Зоны должны знать, где они должны находиться, и для этого вы используете систему целей так же, как и для любого другого
эффекта на основе местоположения, например, удара молнии.

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  VisualCylinder:
    Events:
    - EliteMobDamagedEvent
    Zone:
      radius: 10.0
      shape: CYLINDER
      height: 1
      filter: PLAYER
      borderRadius: 5.0
      Target:
        targetType: SELF
```

Это создает цилиндрическую зону вокруг босса. Обратите внимание, что в этом примере еще не заданы никакие действия, это
будет рассмотрено ниже.

Некоторые зоны, например [STATIC_RAY]($language$/elitemobs/elitescript_zones.md&section=static_ray), имеют две или более
цели. Это связано с тем, что лучи — это линии, а линии определяются двумя точками. Это более подробно рассмотрено
на [странице зон]($language$/elitemobs/elitescript_zones.md), но в основном они все работают одинаково.

</div>

</details>

</div>

### Часть 2 - Нацеливание на внутреннюю часть зоны

Теперь, когда зона знает, где она находится, нам нужно, чтобы действие знало, что его целью является зона, которую мы
определили. Для этого предназначены `targetType: ZONE_FULL` и `targetType:ZONE_BORDER`.

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  VisualCylinder:
    Events:
    - EliteMobDamagedEvent
    Zone:
      radius: 10.0
      shape: CYLINDER
      height: 1
      filter: PLAYER
      borderRadius: 5.0
      Target:
        targetType: SELF
    Actions:
    - action: SPAWN_PARTICLE
      times: 12
      repeatEvery: 5
      particles:
      - particle: SMOKE_NORMAL
      Target:
        targetType: ZONE_FULL
```

Используя ту же зону из первой части, мы теперь добавляем действие. Целью этого действия является `ZONE_FULL`, что
означает, что оно будет создавать частицы внутри всей зоны.

Обратите внимание, что ZONE_BORDER доступен не для каждой зоны. Подробнее об этом
на [странице скриптовых зон]($language$/elitemobs/elitescript_zones.md).

</div>

</details>

</div>

### Отслеживание зоны

Устанавливает, будет ли зона двигаться вместе с целью, например, будет ли зона двигаться, когда босс перемещается
для `targetType: SELF`.

| Значения |                         Детали                         | По умолчанию |
|----------|:------------------------------------------------------:|:------------:|
| `track`  | Устанавливает, будет ли зона двигаться вместе с целью. |    `true`    |

Обратите внимание, что анимируемые зоны не могут отслеживать. [Подробнее об этом здесь.]($language$/elitemobs/elitescript_zones.md&section=animatable)

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  VisualCylinder:
    Events:
    - EliteMobDamagedEvent
    Zone:
      radius: 10.0
      shape: CYLINDER
      height: 1
      filter: PLAYER
      borderRadius: 5.0
      Target:
        targetType: SELF
    Actions:
    - action: SPAWN_PARTICLE
      times: 12
      repeatEvery: 5
      particles:
      - particle: SMOKE_NORMAL
      Target:
        targetType: ZONE_FULL
        track: false
```

</div>

</details>

</div>

Используя тот же пример из части 1 и части 2, зона теперь настроена на то, чтобы не отслеживать. Это означает, что зона
будет появляться в местоположении босса, но даже когда босс будет продолжать удаляться, зона останется там, где она
впервые появилась.

Наконец, обратите внимание, что если зона настроена на то, чтобы не отслеживать, она зарегистрирует свое местоположение в момент вызова скрипта.

Например, если вы хотите иметь фазу предупреждения и фазу нанесения урона для своего скрипта, вам нужно убедиться, что
вы запускаете все действия в начале и устанавливаете время ожидания для всех действий, связанных с нанесением урона,
которые вы хотите запустить позже индивидуально. Не следует задерживать весь скрипт, который вы вызываете
через `RUN_SCRIPT`, по техническим причинам.

Ниже приведен правильный пример способности с фазой предупреждения и фазой нанесения урона, взятый из Святилища Ледяного
Дворца.

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  VisualCylinder:
    Events:
    - EliteMobDamagedEvent
    Zone:
      radius: 10.0
      shape: CYLINDER
      height: 1
      filter: PLAYER
      borderRadius: 5.0
      Target:
        targetType: SELF
    Actions:
    - action: SPAWN_PARTICLE
      times: 12
      repeatEvery: 5
      particles:
      - particle: SMOKE_NORMAL
      Target:
        targetType: ZONE_FULL
        track: false
    - action: SPAWN_PARTICLE
      wait: 60
      times: 13
      repeatEvery: 3
      particles:
      - particle: FLAME
        amount: 0
        x: 0
        y: 1
        z: 0
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: 0.5
        y: 1
        z: 0.5
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: 0
        y: 1
        z: 0.5
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: 0.5
        y: 1
        z: 0
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: -0.5
        y: 1
        z: -0.5
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: -0.5
        y: 1
        z: 0
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: 0
        y: 1
        z: -0.5
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: -0.5
        y: 1
        z: 0.5
        speed: 0.2
      - particle: FLAME
        amount: 0
        x: 0.5
        y: 1
        z: -0.5
        speed: 0.2
      Target:
        targetType: ZONE_FULL
        track: false
    - action: RUN_SCRIPT
      scripts:
      - DamageCylinder
    - action: PLAY_ANIMATION
      sValue: fire_zone
      Target:
        targetType: SELF
    - action: SET_MOB_AI
      duration: 100
      bValue: false
      Target:
        targetType: SELF
    Cooldowns:
      local: 1200
      global: 300
  DamageCylinder:
    Zone:
      radius: 10.0
      shape: CYLINDER
      height: 10
      filter: PLAYER
      borderRadius: 5.0
      Target:
        targetType: SELF
        offset: 0,-1,0
    Actions:
    - action: DAMAGE
      wait: 60
      repeatEvery: 10
      times: 4
      multiplier: 4
      Target:
        targetType: ZONE_FULL
        track: false
    - action: SET_ON_FIRE
      wait: 60
      duration: 80
      Target:
        targetType: ZONE_FULL
        track: false
```

</div>

</details>

</div>

Этот скрипт делает много вещей, но он разделен на два понятных скрипта: `VisualCylinder` и `DamageCylinder`.

`VisualCylinder` выполняется первым и имеет действие `RUN_SCRIPT`, которое немедленно запускает `DamageCylinder`
одновременно с выполнением `VisualCylinder`.

Однако каждое отдельное действие в `DamageCylinder` настроено на ожидание 60 тиков, или 3 секунды.

Это означает, что у босса есть фаза предупреждения в 3 секунды, а затем он наносит урон, и даже если зоны настроены на
то, чтобы не отслеживать, зона предупреждения и зона урона будут находиться в одном и том же месте.

### Свойства цели, специфичные для зоны

Зоны имеют следующие специфические свойства:

#### coverage

Устанавливает процент зоны, который будет фактически использоваться для действия. Работает только для целевых
местоположений (не будет работать при нацеливании на игроков или другие сущности).

| Значения   |                      Детали                       | По умолчанию |
|------------|:-------------------------------------------------:|:------------:|
| `coverage` | Устанавливает процент зоны, который будет покрыт. |    `1.0`     |

<div align="center">

<details> 

<summary><b>Пример</b></summary>

<div align="left">

```yaml
eliteScript:
  VisualCylinder:
    Events:
    - EliteMobDamagedEvent
    Zone:
      radius: 10.0
      shape: CYLINDER
      height: 1
      filter: PLAYER
      borderRadius: 5.0
      Target:
        targetType: SELF
    Actions:
    - action: SPAWN_PARTICLE
      times: 12
      repeatEvery: 5
      particles:
      - particle: SMOKE_NORMAL
      Target:
        targetType: ZONE_FULL
        track: false
        coverage: 0.5
```

В этом случае только 50% зоны будут покрыты частицами.

</div>

</details>

</div>

### Наследование целей

Когда скрипт запускает другой скрипт (или "вызывает" этот скрипт), можно передать информацию о зоне и цели из первого
скрипта во второй.

**Примеры использования**

1. **Улучшенные скрипт-раннеры**

Скрипт-раннеры — это скрипты, единственной функцией которых является запуск множества других скриптов. Они используются
для упрощения управления скриптами, особенно при обработке нескольких скриптов, требующих точного времени.

Благодаря наследованию целей несколько скриптов могут использовать одну и ту же зону или цель, сокращая потенциально сотни строк повторяющегося скриптования.

2. **Фильтрация целей-матрешек / Фильтрация целей по типу русской матрешки**

К целям в действии можно применять условия фильтрации. Передавая цели другому скрипту с другими фильтрами, становится
возможным накладывать условия и применять различные эффекты к одному и тому же пулу целей на основе все более и более
специфических критериев.

В качестве примера, можно создать зону, которая ищет игроков, и сделать действие, которое проверяет, есть ли у всех
игроков в зоне определенный тег. Затем действительные цели могут быть переданы другому скрипту, где другое действие
может затем выполнить случайную проверку условия и применить эффект на основе этой вероятности. Затем цели могут быть
переданы дальше в другой скрипт, где другое условие может проверить, живы ли цели, и выполнить какое-то специальное
поведение, если они мертвы.

Это, конечно, всего лишь примеры. Это очень гибкая система.

3. **Сложные зоны**

Наконец, можно накладывать цели для создания сложных зон, при необходимости используя условия, и даже можно создавать
полуслучайные зоны, используя условия скрипта и возможность запускать только один из перечисленных скриптов из действий
скрипта.

**Примечание:** В этом разделе **"родительским скриптом"** называется скрипт, который запускает **"наследующий скрипт"
**, то есть скрипт, который будет использовать унаследованные цели.
При использовании наследования целей важно внимательно изучить _родительский скрипт_, чтобы убедиться, что передаются правильные данные.

#### INHERIT_SCRIPT_TARGET

При использовании `INHERIT_SCRIPT_TARGET` цели из _родительского скрипта_ будут переданы наследующему скрипту. Это имеет
несколько особенностей:

- При передаче **целей-сущностей** можно запускать действия, требующие местоположения (например, создание частиц),
  поскольку будет использоваться местоположение сущностей. Конечно, также можно использовать действия, требующие
  сущности.

- При передаче **целей-местоположений** можно использовать только местоположения. **Единственный способ получить
  сущность из местоположений — это создать зону в этом месте и искать сущности.** Таким образом, хотя и не невозможно
  передать местоположение, а затем получить сущности, это потребует немного дополнительной работы.

#### Наследование зон

При использовании `INHERIT_SCRIPT_ZONE_FULL` или `INHERIT_SCRIPT_ZONE_BORDER` крайне важно, чтобы _родительский скрипт_
определял зону, иначе _наследующий скрипт_ не сможет правильно запуститься.

Кроме того, зоны могут дополнительно [отслеживаться]($language$/elitemobs/elitescript_targets.md&section=zone-track). Это также будет передано вместе с зоной.

- **Неотслеживаемая** зона всегда будет создавать зону там, где она определена _наследующим скриптом_. Это означает, что настройки зоны будут использоваться действиями в _наследующих скриптах_ для создания совершенно новых зон каждый раз, когда выполняется действие, и местоположение этих зон будет определяться действием.

- **Отслеживаемая** зона может передавать одно и то же точное местоположение зоны всем _наследующим скриптам_, если
  _родительский скрипт_ настроен на нацеливание на `ZONE_FULL` или `ZONE_BORDER`. Это означает, что каждый скрипт будет
  действовать в одних и тех же местоположениях.
