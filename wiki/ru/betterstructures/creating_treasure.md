```markdown
# Что такое файл сокровищ?

Файлы сокровищ определяют таблицы добычи (лута) для сундуков BetterStructures. Обычно они назначаются
[генераторам]($language$/betterstructures/creating_generators.md&section=treasurefilename), но также могут быть установлены на уровне
[конфигурации отдельной постройки]($language$/betterstructures/creating_structures.md&section=treasurefile).

Эти таблицы добычи довольно мощные, но для их понимания требуется знание некоторых базовых статистических концепций.

<details>
<summary>
Прочитайте об этих концепциях здесь, остальная часть страницы предполагает, что вы их понимаете!
</summary>

***Взвешенная вероятность***

BetterStructures и EliteMobs часто используют концепцию взвешенной вероятности. Это решает простую проблему: как установить шанс выбора одного предмета из списка потенциально бесконечного количества предметов?

Взвешенная вероятность решает эту проблему, присваивая каждому предмету вес. Если у вас есть 100 предметов, и каждый имеет вес 1, то у всех равный шанс — 1% — быть выбранным. Если вы добавите еще один предмет, доведя общее количество до 101, и дадите этому последнему предмету шанс 1, все предметы по-прежнему будут иметь одинаковый шанс — ~0.99% — быть выбранными. Если вы дадите последнему предмету вес 2, шанс его выбора увеличится — новый общий вес составит 102, последний элемент имеет вес 2, и 100/102 = ~0.98%, так что 0.98%+0.98% = 1.96% шанс быть выбранным. Если вы дадите последнему предмету вес 100, новый вес составит 200, и поскольку половина этого веса приходится на ваш новый предмет, ваш новый предмет имеет 50% шанс быть выбранным.

Как видите, это удобно использовать, когда у вас могут быть списки из сотен вещей для рандомизации.

***Гауссово распределение***

Гауссово распределение — это математическая функция в форме колокола.

<img src="http://sfonline.barnard.edu/wp-content/uploads/2015/12/gaussian-distribution.jpg">

Вы можете задаться вопросом, как это относится к системе добычи. Одна вещь, которую BetterStructures должна решить при настройке добычи в сундуках, это сколько именно добычи появляется в этих сундуках. Количество должно быть стабильно около определенного числа, но в идеале не настолько предсказуемым, чтобы открытие сундука стало менее захватывающим.

Для достижения этого полуслучайного эффекта используется гауссово распределение для рандомизации *количества* выбранных предметов. Как только это количество выбрано, *взвешенная вероятность* выбирает один элемент из таблицы редкости случайным образом, учитывая веса.

Итак, как работает гауссово распределение?

К счастью, вам не нужно беспокоиться о том, как работает математика за ним, и вместо этого можно сосредоточиться на двух настройках, которые его изменяют: среднее значение (mean) и стандартное отклонение (standard deviation).

*Среднее значение (Mean)*

Проще говоря, `mean` устанавливает середину гауссовой кривой, что означает, что он устанавливает наиболее вероятное количество предметов, которое появится в сундуке. По сути, если вы хотите, чтобы в ваших сундуках обычно было 5 предметов, установите `mean` на 5.

*Стандартное отклонение (Standard deviation)*

Представьте, что среднее количество предметов в сундуке равно 5. `standard deviation` помогает решить, насколько это число может меняться от одного сундука к другому.

Малое `Standard Deviation` (например, 1): Это означает, что в большинстве сундуков будет количество предметов, очень близкое к среднему, например, 4, 5 или 6 предметов. Это более предсказуемый опыт. Например, если у сундука стандартное отклонение 1, вы можете ожидать, что почти во всех сундуках будет от 4 до 6 предметов.

Среднее `Standard Deviation` (например, 2): Здесь больше разнообразия. В сундуках может быть от 3 до 7 предметов. Хотя 5 предметов по-прежнему распространены, найти сундуки с немного большим или меньшим количеством не является чем-то необычным. Так, при стандартном отклонении 2 вы можете иногда найти сундук всего с 3 предметами, или, если повезет, с 7 предметами.

Большое `Standard Deviation` (например, 3 или более): Теперь становится действительно удивительно! В сундуках может быть всего 2 предмета или целых 8 или более. Это означает, что вы можете найти сундук всего с парой предметов, но также есть шанс найти сундук, полный добра. Например, при стандартном отклонении 3 в сундуке может быть от 2 до 8 предметов, что делает каждое открытие сундука захватывающей азартной игрой.

***Среднее значение по умолчанию равно 4, а стандартное отклонение по умолчанию равно 3.***

</details>

***

# Специальный формат

Файлы сокровищ имеют специальный формат, который выглядит так:

```yml
isEnabled: true
mean: 4.0
standardDeviation: 3.0
items:
  common:
    weight: 60
    items:
    - amount: 1-1
      material: STONE_PICKAXE
      procedurallyGenerateEnchantments: true
      weight: 1.0
    - amount: 1-1
      material: STONE_SHOVEL
      procedurallyGenerateEnchantments: true
      weight: 1.0
  rare:
    weight: 30
    items:
    - amount: 1-1
      material: ANVIL
      weight: 6.0
    - amount: 1-6
      material: BEETROOT
      weight: 6.0
  epic:
    weight: 10
    items:
    - amount: 2-10
      material: DIAMOND
      weight: 1.0
    - amount: 1-1
      material: DIAMOND_AXE
      weight: 6.0
procedurallyGeneratedItemSettings:
  golden_sword:
    bane_of_arthropods:
      minLevel: 1
      maxLevel: 5
      chance: 0.2
    looting:
      minLevel: 1
      maxLevel: 3
      chance: 0.2

```

*Примечание: это очень урезанная версия файла, фактический файл имеет длину 2599 строк, так как он охватывает гораздо больше добычи и все возможные зачарования.*

# isEnabled

| Ключ        |       Значения        | По умолчанию |
|-------------|:-------------------:|-|
| `isEnabled` | [Boolean](#boolean) | `true` |

***

# mean

| Ключ   |      Значения       | По умолчанию |
|--------|:-----------------:|---------|
| `mean` | [Double](#double) | `4`     |

Устанавливает `mean` (среднее значение). Прочитайте подробности об этом [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

# standardDeviation

| Ключ                |      Значения       | По умолчанию |
|---------------------|:-----------------:|---------|
| `standardDeviation` | [Double](#double) | `3`     |

Устанавливает `standardDeviation` (стандартное отклонение). Прочитайте подробности об этом [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

# items

Здесь становится немного сложнее, так как многие опции могут быть настроены администраторами. Давайте рассмотрим пример файла конфигурации, приведенный ранее.

```yml
items:
  common:
    weight: 60
    items:
    - amount: 1-1
      material: STONE_PICKAXE
      procedurallyGenerateEnchantments: true
      weight: 1.0
    - amount: 1-1
      material: STONE_SHOVEL
      procedurallyGenerateEnchantments: true
      weight: 1.0
  rare:
    weight: 30
    items:
    - amount: 1-1
      material: ANVIL
      weight: 6.0
    - amount: 1-6
      material: BEETROOT
      weight: 6.0
```

Здесь вы можете видеть, что под ключом конфигурации `items` у нас есть карта с `common` и `rare`. Это `rarities` (редкости)!
***

## rarities

Редкости не имеют фиксированного названия. Вы можете добавлять или удалять их, и настраивать их по своему усмотрению, при условии использования того же формата.

Обратите внимание, что то, что делает эти таблицы редкости более или менее редкими, это `weight` (вес) таблицы добычи!

По умолчанию:
- `common` имеет вес по умолчанию `60`
- `rare` имеет вес по умолчанию `30`
- `epic` имеет вес по умолчанию `10`

Что делает обычные предметы в 6 раз более вероятными для выпадения, чем эпические. Вы можете прочитать больше о `weight` [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?)!

Помимо веса, каждая таблица редкости имеет свой собственный список `items` (предметов).

***

### rarity items

Предметы редкости — это [список-карта](https://magmaguy.com/wiki.html#lang=en&article=global+configuration_file_guide.md&section=map-list), который перечисляет все предметы, содержащиеся в таблице редкости.

Эти предметы имеют следующие настройки:

| Ключ                               |           Значения            | По умолчанию |
|------------------------------------|:---------------------------:|----------|
| `amount`                           | min-max [Integer](#integer) | переменное |
| `material`                         |    [Material](#Material)    | переменное |
| `procedurallyGenerateEnchantments` |     [Boolean](#boolean)     | переменное |
| `weight`                           |      [Double](#double)      | переменное |

***

#### amount

***

Устанавливает количество для выпадения. Это выражается в виде диапазона следующим образом: `amount: MIN-MAX`. Например, чтобы выпало от 1 до 5 предметов: `amount: 1-5`.

#### material

Устанавливает материал, используя [названия из Spigot API](https://hub.spigotmc.org/javadocs/spigot/org/bukkit/Material.html) предмета, который потенциально может выпасть.

***

##### Особый случай - serialized

При использовании команды lootify, вместо материала lootify предоставит настройку `serialized`. Она генерируется плагином автоматически и не должна создаваться вручную. Она находится в формате, который не читается человеком.

***

#### weight

Устанавливает вес для взвешенного шанса. Подробнее об этом [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

#### procedurallyGenerateItems

Устанавливает, должен ли предмет быть процедурно сгенерирован на основе настроек конфигурации `procedurallyGeneratedItemSettings`. Обратите внимание, что в зависимости от настроек это может привести к генерации предмета без зачарований.


# procedurallyGeneratedItemSettings

Давайте еще раз взглянем на наш пример файла конфигурации:

```yml
procedurallyGeneratedItemSettings:
  golden_sword:
    bane_of_arthropods:
      minLevel: 1
      maxLevel: 5
      chance: 0.2
    looting:
      minLevel: 1
      maxLevel: 3
      chance: 0.2
```

Как вы можете видеть, этот файл перечисляет типы материалов, за которыми следуют зачарования, а затем минимальный и максимальный уровни и шанс.

Обратите внимание, что вы не можете добавлять пользовательские материалы из других плагинов в эти настройки, и, вероятно, вы не сможете добавлять пользовательские зачарования из других плагинов, если их автор явно не заявил, что сделал свою систему совместимой.

Что касается настроек зачарований:

| Ключ       |       Значения        | По умолчанию |
|------------|:-------------------:|----------|
| `minLevel` | [Integer](#integer) | переменное |
| `maxLevel` | [Integer](#integer) | переменное |
| `chance`   |  [Chance](#chance)  | переменное |

***

## minLevel

Устанавливает минимальный уровень зачарования.

***

## maxLevel

Устанавливает максимальный уровень зачарования.

***

## chance

Устанавливает шанс срабатывания зачарования. Здесь используется не взвешенная вероятность, а обычный бросок кубика.
```