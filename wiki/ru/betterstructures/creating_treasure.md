# Что такое файл сокровищ?

Файлы сокровищ определяют таблицы добычи для сундуков BetterStructures. Обычно они назначаются
[генераторам]($language$/betterstructures/creating_generators.md&section=treasurefilename), но также могут быть установлены на уровне
[индивидуальной конфигурации сборки]($language$/betterstructures/creating_structures.md&section=treasurefile).

Эти таблицы добычи довольно мощные, но для их понимания также требуются знания некоторых основных статистических концепций.

<details>
<summary>
Прочтите об этих понятиях здесь, остальная часть страницы предполагает, что вы их понимаете!
</summary>

***Взвешенная вероятность***

BetterStructures и EliteMobs часто используют понятие взвешенной вероятности. Это решает простую проблему: как установить шанс выбора одного элемента из списка потенциально бесконечных элементов?

Взвешенная вероятность решает эту проблему, присваивая каждому элементу вес. Если у вас есть 100 элементов, и каждый имеет вес 1, то у всех одинаковый шанс - 1% - быть выбранным. Если вы добавите еще один элемент, доведя общее количество до 101 элемента, и присвоите этому последнему элементу шанс 1, у всех элементов по-прежнему будет одинаковый шанс - ~0,99% - быть выбранным. Если вы присвоите последнему элементу вес 2, вероятность его выбора увеличится - новый общий вес будет 102, последний элемент имеет вес 2 и 100/102 = ~0,98%, поэтому 0,98%+0,98% = 1,96% шанс быть выбранным. Если вы присвоите последнему элементу вес 100, новый вес будет 200, и поскольку половина этого веса приходится на ваш новый элемент, у вашего нового элемента есть 50% шанс быть выбранным.

Как видите, это удобно использовать, когда у вас могут быть списки из сотен вещей для рандомизации.

***Гауссово распределение***

Гауссово распределение - это колоколообразная математическая функция.

<img src="http://sfonline.barnard.edu/wp-content/uploads/2015/12/gaussian-distribution.jpg">

Вы можете задаться вопросом, какое отношение это имеет к системе добычи. Одна из вещей, которую BetterStructures должен решить при установке добычи в сундуках, - это сколько именно добычи появляется в этих сундуках. Количество должно быть постоянно около определенного числа, но в идеале не настолько предсказуемым, чтобы открытие сундука могло стать менее захватывающим.

Для достижения этого полуслучайного эффекта гауссово распределение используется для рандомизации *количества* выбираемых элементов. После того, как это количество выбрано, *взвешенная вероятность* выбирает один элемент из таблицы редкости случайным образом с учетом весов.

Итак, как работает гауссово распределение?

К счастью, вам не нужно беспокоиться о том, как работает математика, и вместо этого вы можете сосредоточиться на двух настройках, которые ее изменяют: среднем значении и стандартном отклонении.

*Среднее значение*

Проще говоря, `среднее значение` устанавливает середину гауссовой кривой, что означает, что оно устанавливает наиболее вероятное количество элементов, которые появятся в сундуке. По сути, если вы хотите, чтобы в ваших сундуках обычно было 5 предметов, установите среднее значение равным 5.

*Стандартное отклонение*

Представьте, что среднее количество предметов в сундуке равно 5. `Стандартное отклонение` помогает определить, насколько это число может изменяться от одного сундука к другому.

Небольшое `стандартное отклонение` (например, 1): это означает, что в большинстве сундуков будут предметы, очень близкие к среднему значению, например, 4, 5 или 6 предметов. Это более предсказуемый опыт. Например, если стандартное отклонение сундука равно 1, вы можете ожидать, что почти во всех сундуках будет от 4 до 6 предметов.

Среднее `стандартное отклонение` (например, 2): здесь больше разнообразия. В сундуках может быть от 3 до 7 предметов. Хотя 5 предметов по-прежнему являются обычными, нередки случаи, когда в сундуках немного больше или меньше. Итак, со стандартным отклонением 2 вы можете иногда найти сундук только с 3 предметами, или, если вам повезет, сундук с 7 предметами.

Большое `стандартное отклонение` (например, 3 или больше): теперь все становится действительно неожиданным! В сундуках может быть всего 2 предмета или целых 8 или более. Это означает, что вы можете найти сундук всего с парой предметов, но также есть шанс найти сундук, полный вкусностей. Например, со стандартным отклонением 3 в сундуке может быть от 2 до 8 предметов, что делает каждое открытие сундука захватывающей азартной игрой.

***Среднее значение по умолчанию равно 4, а стандартное отклонение по умолчанию равно 3.***

</details>

***

# Специальный формат

Файлы сокровищ имеют специальный формат, который выглядит следующим образом:

```yml
isEnabled: true
mean: 4.0
standardDeviation: 3.0
items:
  common:
    weight: 60
    items:
    - amount: 1-1
      material: STONE_PICKAXE
      procedurallyGenerateEnchantments: true
      weight: 1.0
    - amount: 1-1
      material: STONE_SHOVEL
      procedurallyGenerateEnchantments: true
      weight: 1.0
  rare:
    weight: 30
    items:
    - amount: 1-1
      material: ANVIL
      weight: 6.0
    - amount: 1-6
      material: BEETROOT
      weight: 6.0
  epic:
    weight: 10
    items:
    - amount: 2-10
      material: DIAMOND
      weight: 1.0
    - amount: 1-1
      material: DIAMOND_AXE
      weight: 6.0
procedurallyGeneratedItemSettings:
  golden_sword:
    bane_of_arthropods:
      minLevel: 1
      maxLevel: 5
      chance: 0.2
    looting:
      minLevel: 1
      maxLevel: 3
      chance: 0.2

```

*Примечание: это очень урезанная версия файла, фактический файл состоит из 2599 строк, поскольку он охватывает гораздо больше добычи и каждое возможное зачарование.*

# isEnabled

| Ключ        | Значения              | По умолчанию |
|-------------|:---------------------:|-------------:|
| `isEnabled` | [Булево](#boolean)  | `true`       |

***

# mean

| Ключ   | Значения           | По умолчанию |
|--------|:------------------:|-------------:|
| `mean` | [Double](#double) | `4`          |

Установите `среднее значение`. Подробности об этом читайте [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

# standardDeviation

| Ключ                | Значения           | По умолчанию |
|---------------------|:------------------:|-------------:|
| `standardDeviation` | [Double](#double) | `3`          |

Установите `standardDeviation`. Подробности об этом читайте [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

# items

Вот тут становится сложно, так как многие параметры могут быть установлены администраторами. Давайте поближе рассмотрим пример файла конфигурации из предыдущего раздела.

```yml
items:
  common:
    weight: 60
    items:
    - amount: 1-1
      material: STONE_PICKAXE
      procedurallyGenerateEnchantments: true
      weight: 1.0
    - amount: 1-1
      material: STONE_SHOVEL
      procedurallyGenerateEnchantments: true
      weight: 1.0
  rare:
    weight: 30
    items:
    - amount: 1-1
      material: ANVIL
      weight: 6.0
    - amount: 1-6
      material: BEETROOT
      weight: 6.0
```

Здесь вы можете увидеть, что в разделе конфигурации `items` у нас есть карта с `common` и `rare`. Это `редкости`!
***

## rarities

У редкостей нет фиксированного названия. Вы можете добавлять или удалять их и настраивать их так, как вам хочется, если вы используете один и тот же формат.

Обратите внимание, что то, что делает эти таблицы редкости более или менее редкими, - это `вес` таблицы добычи!

По умолчанию:
- `common` имеет вес по умолчанию `60`
- `rare` имеет вес по умолчанию `30`
- `epic` имеет вес по умолчанию `10`

Делает обычные предметы в 6 раз более вероятными, чем эпические предметы. Вы можете прочитать больше о `весах` [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?)!

Помимо веса, у каждой таблицы редкости есть свой собственный список `items`.

***

### rarity items

Элементы редкости - это [список карт](https://magmaguy.com/wiki.html#lang=en&article=global+configuration_file_guide.md&section=map-list), в котором перечислены все элементы, которые есть в таблице редкости.

Эти элементы имеют следующие настройки:

| Ключ                                | Значения                    | По умолчанию |
|------------------------------------|:---------------------------:|-------------:|
| `amount`                           | min-max [Целое](#integer)   | переменная   |
| `material`                         | [Материал](#Material)       | переменная   |
| `procedurallyGenerateEnchantments` | [Булево](#boolean)          | переменная   |
| `weight`                           | [Double](#double) | переменная   |

***

#### amount

***

Устанавливает количество для выпадения. Это выражается как диапазон следующим образом: `amount: MIN-MAX`. Например, чтобы выпало от 1 до 5
предметов: `amount: 1-5`.

#### material

Устанавливает материал, используя [названия Spigot API](https://hub.spigotmc.org/javadocs/spigot/org/bukkit/Material.html)
элемента для потенциального выпадения.

***

##### Особый случай - сериализованный

При использовании команды lootify вместо материала lootify предоставит параметр `serialized`. Он автоматически генерируется плагином и не должен генерироваться вручную. Он имеет формат, который не читается человеком.

***

#### weight

Устанавливает вес для взвешенной вероятности. Подробнее об этом [здесь](https://magmaguy.com/wiki.html#lang=en&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

#### procedurallyGenerateItems

Устанавливает, должен ли элемент генерироваться процедурно на основе настроек конфигурации, если `procedurallyGeneratedItemSettings`. Обратите внимание, что в зависимости от настроек это может привести к тому, что элемент будет генерироваться без зачарований.

# procedurallyGeneratedItemSettings

Давайте еще раз посмотрим на пример нашего файла конфигурации:

```yml
procedurallyGeneratedItemSettings:
  golden_sword:
    bane_of_arthropods:
      minLevel: 1
      maxLevel: 5
      chance: 0.2
    looting:
      minLevel: 1
      maxLevel: 3
      chance: 0.2
```

Как видите, в этом файле перечислены типы материалов, за которыми следуют зачарования, а затем минимальные и максимальные уровни и шанс.

Обратите внимание, что вы не можете добавлять пользовательские материалы из других плагинов в эти настройки, и вы, вероятно, не сможете добавлять пользовательские зачарования из других плагинов, если их автор явно не заявляет, что они сделали свою систему совместимой.

Что касается настроек зачарования:

| Ключ        | Значения          | По умолчанию |
|------------|:-----------------:|-------------:|
| `minLevel` | [Целое](#integer) | переменная   |
| `maxLevel` | [Целое](#integer) | переменная   |
| `chance`   | [Шанс](#chance)   | переменная   |

***

## minLevel

Устанавливает минимальный уровень зачарования.

***

## maxLevel

Устанавливает максимальный уровень зачарования.

***

## chance

Устанавливает шанс срабатывания зачарования. Здесь не используется взвешенная вероятность, а просто нормальный бросок кубика.
