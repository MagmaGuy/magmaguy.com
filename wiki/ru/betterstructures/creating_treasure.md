# Что такое файл сокровищ?

Файлы сокровищ определяют таблицы добычи для сундуков BetterStructures. Обычно они назначаются
[генераторам]($language$/betterstructures/creating_generators.md&section=treasurefilename), но также могут быть
установлены на
уровне [отдельной конфигурации сборки]($language$/betterstructures/creating_structures.md&section=treasurefile).

Эти таблицы добычи достаточно мощные, но для понимания также требуется знание некоторых основных статистических
концепций.

<details>
<summary>
Прочитайте об этих концепциях здесь, остальная часть страницы предполагает, что вы их понимаете!
</summary>

***Взвешенная вероятность***

BetterStructures и EliteMobs часто используют концепцию взвешенной вероятности. Это для решения простой проблемы: как
установить вероятность выбора одного предмета из списка потенциально бесконечных предметов?

Взвешенная вероятность решает эту проблему, присваивая каждому предмету вес. Если у вас есть 100 предметов и каждый
имеет вес 1, то у всех одинаковый шанс - 1% - быть выбранным. Если вы добавите еще один предмет, доведя общее количество
до 101 предмета, и дадите этому последнему предмету шанс 1, все предметы по-прежнему будут иметь одинаковый шанс - ~
0,99% - быть выбранным. Если вы дадите последнему предмету вес 2, вероятность его выбора увеличится - новый общий вес
будет 102, последний элемент имеет вес 2 и 100/102 = ~0,98%, поэтому 0,98%+0,98% = 1,96% шанса быть выбранным. Если вы
дадите последнему предмету вес 100, новый вес будет 200, и поскольку половина этого веса - ваш новый предмет, ваш новый
предмет имеет 50% шанс быть выбранным.

Как видите, это хорошо использовать, когда у вас могут быть списки из сотен вещей для рандомизации.

***Гауссово распределение***

Гауссово распределение - это математическая функция в форме колокола.

<img src="http://sfonline.barnard.edu/wp-content/uploads/2015/12/gaussian-distribution.jpg">

Вы можете задаться вопросом, какое это имеет отношение к системе добычи. Одна из вещей, которую BetterStructures должна
решить при настройке добычи в сундуках, - это то, сколько добычи появляется в этих сундуках. Количество должно быть
постоянно около определенного числа, но в идеале не настолько предсказуемым, чтобы открытие сундука стало менее
захватывающим.

Для достижения этого полуслучайного эффекта гауссово распределение используется для рандомизации *количества* выбираемых
предметов. Как только это количество выбрано, *взвешенная вероятность* выбирает один элемент из таблицы редкости
случайным образом с учетом весов.

Итак, как работает гауссово распределение?

К счастью, вам не нужно беспокоиться о том, как работает математика, и вместо этого вы можете сосредоточиться на двух
настройках, которые ее изменяют: среднее значение и стандартное отклонение.

*Среднее значение*

Проще говоря, `среднее значение` устанавливает середину гауссовой кривой, что означает, что оно устанавливает наиболее
вероятное количество предметов, которые появятся в сундуке. По сути, если вы хотите, чтобы в ваших сундуках обычно было
5 предметов, установите среднее значение на 5.

*Стандартное отклонение*

Представьте, что среднее количество предметов в сундуке равно 5. `Стандартное отклонение` помогает определить, насколько
это число может меняться от одного сундука к другому.

Малое `Стандартное отклонение` (например, 1): это означает, что у большинства сундуков будут предметы, очень близкие к
среднему, например, 4, 5 или 6 предметов. Это более предсказуемый опыт. Например, если у сундука стандартное отклонение
1, вы можете ожидать, что почти у всех сундуков будет от 4 до 6 предметов.

Среднее `Стандартное отклонение` (например, 2): здесь больше разнообразия. У сундуков может быть от 3 до 7 предметов.
Хотя 5 предметов по-прежнему распространены, нередко можно найти сундуки с немного большим или меньшим количеством
предметов. Итак, при стандартном отклонении 2 вы можете иногда найти сундук всего с 3 предметами или, если вам повезет,
с 7 предметами.

Большое `Стандартное отклонение` (например, 3 или больше): теперь все становится действительно удивительным! У сундуков
может быть всего 2 предмета или целых 8 или более. Это означает, что вы можете найти сундук всего с парой предметов, но
есть также шанс найти сундук, наполненный вкусностями. Например, при стандартном отклонении 3 у сундука может быть от 2
до 8 предметов, что делает каждое открытие сундука захватывающей авантюрой.

***Среднее значение по умолчанию равно 4, а стандартное отклонение по умолчанию равно 3.***

</details>

***

# Специальный формат

Файлы сокровищ имеют специальный формат, который выглядит следующим образом:

```yml
isEnabled: true
mean: 4.0
standardDeviation: 3.0
items:
  common:
    weight: 60
    items:
    - amount: 1-1
      material: STONE_PICKAXE
      procedurallyGenerateEnchantments: true
      weight: 1.0
    - amount: 1-1
      material: STONE_SHOVEL
      procedurallyGenerateEnchantments: true
      weight: 1.0
  rare:
    weight: 30
    items:
    - amount: 1-1
      material: ANVIL
      weight: 6.0
    - amount: 1-6
      material: BEETROOT
      weight: 6.0
  epic:
    weight: 10
    items:
    - amount: 2-10
      material: DIAMOND
      weight: 1.0
    - amount: 1-1
      material: DIAMOND_AXE
      weight: 6.0
procedurallyGeneratedItemSettings:
  golden_sword:
    bane_of_arthropods:
      minLevel: 1
      maxLevel: 5
      chance: 0.2
    looting:
      minLevel: 1
      maxLevel: 3
      chance: 0.2

```

*Примечание: это очень урезанная версия файла, фактический файл имеет длину 2599 строк, поскольку он охватывает гораздо
больше добычи и все возможные зачарования.*

# isEnabled

| Ключ        |      Значения       | По умолчанию |
|-------------|:-------------------:|--------------|
| `isEnabled` | [Boolean](#boolean) | `true`       |

***

# mean

| Ключ   |     Значения      | По умолчанию |
|--------|:-----------------:|--------------|
| `mean` | [Double](#double) | `4`          |

Установите `среднее значение`. Прочитайте подробности об
этом [здесь](https://magmaguy.com/wiki.html#lang=ru&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

# standardDeviation

| Ключ                |     Значения      | По умолчанию |
|---------------------|:-----------------:|--------------|
| `standardDeviation` | [Double](#double) | `3`          |

Установите `стандартное отклонение`. Прочитайте подробности об
этом [здесь](https://magmaguy.com/wiki.html#lang=ru&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

# items

Здесь становится сложнее, поскольку многие параметры могут быть установлены администраторами. Давайте подробнее
рассмотрим пример файла конфигурации из предыдущего раздела.

```yml
items:
  common:
    weight: 60
    items:
    - amount: 1-1
      material: STONE_PICKAXE
      procedurallyGenerateEnchantments: true
      weight: 1.0
    - amount: 1-1
      material: STONE_SHOVEL
      procedurallyGenerateEnchantments: true
      weight: 1.0
  rare:
    weight: 30
    items:
    - amount: 1-1
      material: ANVIL
      weight: 6.0
    - amount: 1-6
      material: BEETROOT
      weight: 6.0
```

Здесь вы можете увидеть, что под ключом конфигурации `items` у нас есть карта с `common` и `rare`. Это `редкости`!
***

## rarities

Редкости не имеют фиксированного имени. Вы можете добавлять или удалять их и настраивать их столько, сколько захотите,
при условии, что вы используете тот же формат.

Обратите внимание, что то, что делает эти таблицы редкостей более или менее редкими, - это `вес` таблицы добычи!

По умолчанию:
- `common` имеет вес по умолчанию `60`
- `rare` имеет вес по умолчанию `30`
- `epic` имеет вес по умолчанию `10`

Делая обычные предметы в 6 раз более вероятными для выпадения, чем эпические предметы. Вы можете прочитать больше
о `весах` [здесь](https://magmaguy.com/wiki.html#lang=ru&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?)!

Помимо веса, у каждой таблицы редкости есть свой список `предметов`.

***

### rarity items

Предметы редкости -
это [список карт](https://magmaguy.com/wiki.html#lang=ru&article=global+configuration_file_guide.md&section=map-list), в
котором перечислены все предметы, которые есть в таблице редкости.

Эти предметы имеют следующие настройки:

| Ключ                               |          Значения           | По умолчанию |
|------------------------------------|:---------------------------:|--------------|
| `amount`                           | min-max [Integer](#integer) | переменно    |
| `material`                         |    [Material](#Material)    | переменно    |
| `procedurallyGenerateEnchantments` |     [Boolean](#boolean)     | переменно    |
| `weight`                           |      [Double](#double)      | переменно    |

***

#### amount

***

Устанавливает количество для выпадения. Это выражается как диапазон следующим образом `amount: MIN-MAX`. В качестве
примера, чтобы выпало от 1 до 5
предметов: `amount: 1-5`.

#### material

Устанавливает материал, используя [имена Spigot API](https://hub.spigotmc.org/javadocs/spigot/org/bukkit/Material.html)
предмета, который может выпасть.

***

##### Особый случай - сериализованный

При использовании команды lootify вместо материала lootify предоставит настройку `serialized`. Она генерируется
автоматически плагином и не должна генерироваться вручную. Она имеет формат, не читаемый человеком.

***

#### weight

Устанавливает вес для взвешенного шанса. Подробнее об
этом [здесь](https://magmaguy.com/wiki.html#lang=ru&article=betterstructures+creating_treasure.md&section=what-is-a-treasure-file?).

***

#### procedurallyGenerateItems

Указывает, должен ли предмет генерироваться процедурно на основе настроек конфигурации
в `procedurallyGeneratedItemSettings`. Обратите внимание, что в зависимости от настроек это может привести к генерации
предмета без зачарований, независимо от этого.

# procedurallyGeneratedItemSettings

Давайте еще раз посмотрим на пример нашего файла конфигурации:

```yml
procedurallyGeneratedItemSettings:
  golden_sword:
    bane_of_arthropods:
      minLevel: 1
      maxLevel: 5
      chance: 0.2
    looting:
      minLevel: 1
      maxLevel: 3
      chance: 0.2
```

Как видите, в этом файле перечислены типы материалов, за которыми следуют зачарования, а затем минимальные и максимальные уровни и шанс.

Обратите внимание, что вы не можете добавлять пользовательские материалы из других плагинов в эти настройки, и вы,
вероятно, не сможете добавлять пользовательские зачарования из других плагинов, если их автор явно не заявит, что сделал
свою систему совместимой.

Что касается настроек зачарования:

| Ключ       |      Значения       | По умолчанию |
|------------|:-------------------:|--------------|
| `minLevel` | [Integer](#integer) | переменно    |
| `maxLevel` | [Integer](#integer) | переменно    |
| `chance`   |  [Chance](#chance)  | переменно    |

***

## minLevel

Устанавливает минимальный уровень зачарования.

***

## maxLevel

Устанавливает максимальный уровень зачарования.

***

## chance

Устанавливает вероятность возникновения зачарования. Здесь не используется взвешенная вероятность, а просто обычное
бросание кубика.
