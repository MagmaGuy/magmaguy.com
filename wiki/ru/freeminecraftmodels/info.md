# ***Прежде чем начать!***

FreeMinecraftModels (FMM) в настоящее время находится на стадии **альфа-тестирования**! Это означает, что некоторые функции еще не завершены и активно разрабатываются.

Однако на данный момент ядро плагина полностью функционально - преобразование файлов bbmodel, генерация ресурспаков, спавн сущностей в игре и управление их анимациями работают, хотя, возможно, и не на 100% отлажено.

Рассмотрите возможность поддержать разработку по адресу https://www.patreon.com/magmaguy!

Содержимое экспортируемого ресурспака лицензируется в соответствии с лицензией CC0, все права не защищены. Вы можете свободно использовать, распространять, изменять для любых целей без ограничений или необходимости указания авторства.

# Использование этого плагина

## Что FreeMinecraftModels (FMM) может сделать для администраторов серверов Minecraft?

Он может:

- Импортировать модели в формате .bbmodel или fmmodel (пользовательский формат FFM)
- Генерировать ресурспаки с моделями, которые превышают обычные ограничения моделей ресурспака Minecraft (до ~~112x112x112~~
  106x106x106 единиц или 7x7x7 блоков в игре)
- Отображать эти модели в игре с помощью команды `/fmm spawn static <id>`, где id - это имя файла модели, в нижнем регистре и без расширения файла
- Анимировать эти модели в соответствии с их настройками в Blockbench
- Обрабатывать анимации по умолчанию без необходимости использования других плагинов (ходьба, бездействие, смерть, атака, появление)

### Как добавить существующую модель?

Чтобы импортировать модель, просто перетащите файл .bbmodel в папку imports и выполните команду `/fmm reload`. Это сгенерирует файл .fmmodel в папке `models` и добавит модель в ресурспак в папке `outputs`.

***Вам нужно будет использовать этот ресурспак, чтобы правильно просмотреть модель!*** Это обычный ресурспак, поэтому все, что вам нужно сделать, это поместить его в папку с ресурспаками. Серверы Minecraft имеют возможность размещать ресурспаки на сторонних сервисах, таких как Google Drive или специализированный сервис, например https://resourcepack.host/, последний сайт может быть самым простым способом это сделать.

### Как посмотреть модель в игре?

Существует две (запланированные) категории моделей.

- `Статические` модели предназначены для моделей, которые не двигаются (но могут иметь анимации), и служат больше как украшения - например, фонарный столб или новогодняя елка.
- `Динамические` модели предназначены для моделей, которые ведут себя как мобы Minecraft, то есть они перемещаются и выполняют различные действия, связанные с мобами. Например, модели пользовательских боссов или добавление совершенно новых типов сущностей в Minecraft.

#### Просмотр статических моделей в игре

Чтобы просмотреть статические модели в игре, используйте команду `/fmm spawn static <id>`, где id - это имя файла модели, в нижнем регистре и без расширения файла.

#### Просмотр динамических моделей в игре

Чтобы просмотреть динамические модели в игре, используйте команду `/fmm spawn dynamic <id>`, где id - это имя файла модели, в нижнем регистре и без расширения файла.

## Что FreeMinecraftModels (FMM) может сделать для модельеров?

FMM следует стандартным правилам ресурспака для генерации ресурспаков. Кроме того, он старается быть максимально совместимым с моделями, совместимыми с ModelEngine, чтобы стандартизировать создание моделей для всех плагинов.

### Особенности/ограничения генерации моделей

Если вы когда-либо создавали модели для ModelEngine, вы будете знакомы со многими ограничениями генерации ресурспаков Minecraft:

#### **Кубы:**

Кубы здесь такие же, как и в Blockbench, это кубы, из которых состоит модель.

- Кубы могут иметь размер до ~~112x112x112~~ 106x106x106 "пикселей" (единиц Blockbench) или 7x7x7 блоков в игре (обычные ограничения Minecraft обходятся с помощью размеров дисплея, скоро будут дополнительно обходиться для 1.19.4+ благодаря сущностям дисплея)
- Допустимые вращения для кубов: 0, 22.5, -22.5, 45 и -45. Другие вращения не работают.
- Кубы вращаются только по одной оси, то есть вращение [22.5, 0, 0] допустимо, а вращение [22.5, 0, 45] не будет работать в полной мере и будет вращаться только по одной оси.

#### **Кости:**

Кости - это то, что Blockbench называет "группами". Они служат для группировки кубов, и их следует использовать для группировки костей для blueprints анимаций.

- Кости могут иметь размер до ~~112x112x112~~ 106x106x106 (должно быть 112, не знаю, почему это так) "пикселей" (единиц Blockbench) или 7x7x7 блоков в игре. *Обратите внимание, что размер костей устанавливается в зависимости от того, что они содержат, поэтому, если у вас есть кубы, которые находятся на расстоянии более 7 блоков друг от друга, вы, вероятно, превысите этот предел размера. Обход этого ограничения так же прост, как помещение блоков в другую blueprint кости, не содержащуюся в первой blueprint кости!*
- Могут иметь любое вращение!

Кости значительно более гибкие, чем кубы, но костей следует использовать как можно меньше! В FMM, из-за ограничений Minecraft, каждая blueprint кости является отдельной сущностью. В масштабе это довольно быстро скажется на производительности! Всегда используйте как можно меньше костей и помните, сколько моделей вы планируете спавнить - чем больше вы планируете иметь, тем меньше костей должно быть!

#### **Виртуальные кости**

Если вы перешли с ModelEngine, вам, вероятно, интересно, реализованы ли/как виртуальные кости в FMM. Виртуальные кости были запланированы, но в настоящее время не реализованы за пределами очень базовой основы.

Однако, по крайней мере, следующие виртуальные кости вскоре будут совместимы с FMM:

- Хитбоксы / высота глаз: blueprint кости под названием "hitbox" с blueprint куба, определяющего границы, и имеющего одинаковое значение x и z (будет выбрано наибольшее значение, если они не совпадают), определяет хитбокс. Уровень глаз устанавливается в точке поворота blueprint кости хитбокса.
- Имя тега: blueprint кости, имя которой начинается с "tag_". Честно говоря, я бы предпочел быть более конкретным здесь и использовать "tag_name", чтобы использовать теги для других вещей, но это будет серьезно рассмотрено позже.

Нет гарантии, что в ближайшее время будут добавлены другие функции blueprint виртуальных костей.

## Объединение ресурспаков

При использовании FMM вам, вероятно, потребуется объединить ресурспаки.

Вы можете объединить ресурспаки вручную, но мы рекомендуем использовать онлайн-инструмент, такой как [merge.elmakers](https://merge.elmakers.com/), для объединения ваших ресурспаков.

#### **Более безопасное, простое, нередактируемое распространение файлов**

Одна из задач, которую FMM пытается решить, - это использование пользователями моделей, которые они получили, для их редактирования таким образом, который создатель модели не хотел бы, чтобы они редактировали, особенно с целью перекрасить или иным образом немного изменить модель и потенциально попытаться перепродать ее как оригинальное творение.

С этой целью FMM использует формат файлов `.fmmodel`, который направлен на то, чтобы обрезать файлы `.bbmodel` до такой степени, чтобы они могли использоваться плагином, но не могли редактироваться в Blockbench.

Как создатель моделей, теперь у вас есть выбор: выпускать нередактируемый файл `.fmmodel`, редактируемый файл `.bbmodel` или даже установить дифференцированные цены или условия обслуживания для этих двух файлов.

Сгенерировать файл `.fmmodel` так же просто, как поместить файл `.bbmodel` в папку `~/plugins/FreeMinecraftModels/imports` и перезагрузить плагин с помощью команды `/fmm reload` или перезапустить сервер. Затем ваш файл `.fmmodel` будет находиться в папке `~/plugins/FreeMinecraftModels/models`.

## Что FreeMinecraftModels (FMM) может сделать для разработчиков, которые хотят интегрировать его в свои плагины?

У FMM есть репозиторий Maven!
Maven:

```xml
<repository>
    <id>ossrh-public</id>
    <url>https://s01.oss.sonatype.org/content/groups/snapshots/</url>
</repository>

<dependency>
<groupId>com.magmaguy</groupId>
<artifactId>FreeMinecraftModels</artifactId>
<version>1.1.3-SNAPSHOT</version>
<scope>provided</scope>
</dependency>
```

Gradle:

```kotlin
compileOnly group : 'com.magmaguy', name: 'FreeMinecraftModels', version: '1.1.2-SNAPSHOT'
```

*Примечание: FreeMinecraftModels предназначен для использования в качестве API и потребует установки плагина на сервере. Не добавляйте его в свой плагин!*

FMM стремится быть максимально простым в использовании в качестве API.

Прямо сейчас есть только один класс, о котором вам нужно знать, если вы хотите использовать FMM в качестве API для своего плагина, и это `StaticEntity`.

Вот фрагмент кода для обработки статической модели:

```java
public class FreeMinecraftModelsModel {
    private StaticEntity staticEntity = null;

    //Создать модель
    public FreeMinecraftModelsModel(String id, Location location) {
        //Это спавнит сущность!
        staticEntity = StaticEntity.create(id, location);
        //Это проверяет, правильно ли заспавнилась сущность
        if (staticEntity == null) Logger.warningMessage("FMM не удалось найти модель с именем " + id + " !");
    }

    public void remove() {
        //Это удаляет сущность
        staticEntity.remove();
    }
}
```

Имейте в виду, что статические модели предназначены для того, чтобы оставаться на месте и действовать как декоративный элемент в фиксированном месте (анимации не считаются "движением"). Хотя их можно перемещать, подумайте, не лучше ли вам использовать динамическую модель, если это ваша цель.

А вот как EliteMobs, мой плагин для пользовательских боссов, использует динамические сущности:

```java
package com.magmaguy.elitemobs.thirdparty.custommodels.freeminecraftmodels;

import com.magmaguy.elitemobs.mobconstructor.custombosses.CustomBossEntity;
import com.magmaguy.elitemobs.thirdparty.custommodels.CustomModelInterface;
import com.magmaguy.freeminecraftmodels.api.ModeledEntityManager;
import com.magmaguy.freeminecraftmodels.customentity.DynamicEntity;
import lombok.Getter;
import org.bukkit.entity.LivingEntity;

public class CustomModelFMM implements CustomModelInterface {
    @Getter
    private DynamicEntity dynamicEntity;

    public CustomModelFMM(LivingEntity livingEntity, String modelName, String nametagName) {
        dynamicEntity = DynamicEntity.create(modelName, livingEntity);
        if (dynamicEntity == null) return;
        dynamicEntity.setName(nametagName);
    }

    public static void reloadModels() {
        ModeledEntityManager.reload();
    }

    public static boolean modelExists(String modelName) {
        return ModeledEntityManager.modelExists(modelName);
    }

    @Override
    public void shoot() {
        if (dynamicEntity.hasAnimation("attack_ranged")) dynamicEntity.playAnimation("attack_ranged", false);
        else dynamicEntity.playAnimation("attack", false);
    }

    @Override
    public void melee() {
        if (dynamicEntity.hasAnimation("attack_melee")) dynamicEntity.playAnimation("attack_melee", false);
        else dynamicEntity.playAnimation("attack", false);
    }

    @Override
    public void playAnimationByName(String animationName) {
        dynamicEntity.playAnimation(animationName, false);
    }

    @Override
    public void setName(String nametagName, boolean visible) {
        dynamicEntity.setName(nametagName);
        dynamicEntity.setNameVisible(visible);
    }

    @Override
    public void setNameVisible(boolean visible) {
        dynamicEntity.setNameVisible(visible);
    }

    @Override
    public void switchPhase() {
        dynamicEntity.stopCurrentAnimations();
    }
}
```

Динамические модели построены на основе живой сущности, которая может быть предоставлена либо при использовании метода create, как в приведенном выше примере, либо при выполнении метода spawn для динамической сущности.

Хотя в настоящее время нет формального ресурса API, все элементы, предназначенные для использования API, содержатся в ModeledEntity (базовый класс для всех сущностей), StaticEntity, DynamicEntity и ModeledEntityManager. 99% разработчиков должны найти все необходимые им методы в этих трех классах.

# Участие в проекте FreeMinecraftModels (FMM) в качестве разработчика

FMM распространяется под лицензией GPLV3, и вклад кода приветствуется. Вот основные правила участия:

- Следуйте существующим соглашениям об именовании, поддерживайте существующий уровень многословности и добавьте достаточно документации, чтобы ваше участие было легко понять
- Поддерживайте соответствие вклада сфере действия плагина. Если вы не знаете, будет ли это уместно, не стесняйтесь спросить заранее.
- Помните о влиянии вашего кода на производительность. Некоторые вклады могут быть отклонены, если они недостаточно оптимизированы или иным образом оказывают слишком большое влияние на производительность.

## Общая схема плагина

Чтобы сэкономить ваше время, вот краткое изложение логического потока FMM:

1) Чтение папки `imports`
2) Перемещение файлов из папки `imports` в папку `models`. Если файл является файлом `.bbmodel`, он преобразуется
   в `.fmmodel` в папке models.
3) Чтение файлов в папке `models`.
4) Интерпретация всех структур модели, создание `Skeleton`s, которые содержат группы `Bone`s, а эти кости содержат группы
   дочерних `Bone`s и `Cube`s. `Cube`s и `Bone`s генерируют данные JSON ресурспака, с которыми каждый из них связан. Это
   означает, что `Cube`s генерируют JSON, специфичный для кубов, а `Bone`s генерируют контур и отдельные файлы blueprint костей. Обратите внимание, что одна blueprint кости приводит к одному файлу ресурспака. Модели добавляются в список по мере их
   генерации.
5) По-прежнему в `Skeleton`, интерпретация всех `Animations` в модели, если они есть
6) Все данные теперь инициализированы, ресурспак был сгенерирован в папке `outputs`, и плагин готов к
   использованию.

## Трюки, используемые в этом плагине:

Используемые здесь трюки довольно хорошо зарекомендовали себя и стандартизированы, но тем не менее будут перечислены, поскольку они могут быть неинтуитивными.

Обратите внимание, что все эти трюки полностью невидимы для пользователей и создателей моделей; ограничения и обходные пути перечислены только для того, чтобы помочь вам понять, как FMM обходит различные ограничения Minecraft.

- Все модели увеличиваются в 4 раза, а затем размер и точка поворота перенастраиваются в коде, чтобы увеличить теоретический максимальный размер модели.
- Поскольку размеры моделей ресурспаков могут иметь только диапазон от -16 до +32, модели сдвигаются в фоновом режиме. Это совершенно невидимо для игроков.
- Кожаная конская броня используется для создания моделей с оттенком, на который можно влиять с помощью кода (например, для индикации повреждений). Для отображения правильных цветов конская броня должна быть установлена ​​на белый цвет!
- Blockbench использует определенную систему идентификаторов для текстур, но на самом деле читает текстуры последовательно из конфигурации. Здесь идентификаторы присваиваются на основе их положения в списке текстур, следуя тому, как это делает Blockbench.
- Каждая blueprint кости - это отдельная сущность бронестойки из-за ограничений Minecraft.
- Кожаная конская броня находится на головном слоте бронестойки
- Бронестойки используются для статических элементов по умолчанию. //todo: скоро мне придется реализовать новую альтернативную систему отображения из MC 1.19.4+, она намного эффективнее.
- Чтобы избежать конфликтов с другими плагинами, которые изменяют кожаную конскую броню, FMM использует пользовательские значения данных модели, начиная с 50 000.

# Общий вклад в проект FreeMinecraftModels (FMM)

FMM фактически финансируется благодаря замечательным людям на [https://www.patreon.com/magmaguy](https://www.patreon.com/magmaguy)! Любой вклад помогает больше, чем вы можете себе представить ;)

# Запланированные в настоящее время функции:
- Генерация RSP клиента Bedrock.
- Независимое от свойств сервера управление RSP с интеграцией Geyser.
- Пользовательские сущности (?).
- tag_projectile в качестве мета-костей, из которых можно стрелять снарядами (может быть более одного на модель).

# Текущие странные ограничения, которые необходимо исправить:
- Если точка поворота (начало координат) blueprint кости установлена ​​на значение более 67, модель начинает плавать.
