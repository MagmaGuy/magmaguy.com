# ***Прежде чем начать!***

FreeMinecraftModels (FMM) в настоящее время находится в **альфа-версии**! Это означает, что некоторые функции еще не
завершены и активно находятся в разработке.

Однако на данный момент ядро плагина полностью функционально - конвертация файлов bbmodel, генерация ресурспаков,
спавн сущностей в игре и управление их анимацией - все работает, пусть и не на 100% отполировано.

Рассмотрите возможность поддержки разработки на https://www.patreon.com/magmaguy!

Содержимое экспортируемых ресурспаков распространяется по лицензии CC0, без сохранения каких-либо прав. Вы можете
свободно
использовать, распространять, модифицировать их для любых целей без ограничений или необходимости указания авторства.

# Использование этого плагина

## Что FreeMinecraftModels (FMM) может сделать для администраторов серверов Minecraft?

Он может:

- Импортировать модели .bbmodel или fmmodel (пользовательский формат FMM)
- Генерировать ресурспаки с моделями, которые превышают обычные ограничения моделей ресурспаков Minecraft (до ~~
  112x112x112~~
  106x106x106 единиц или 7x7x7 игровых блоков)
- Отображать эти модели в игре с помощью команды `/fmm spawn static <id>`, где id - это имя файла модели в нижнем
  регистре
  и без расширения файла.
- Анимировать эти модели так, как они были настроены в Blockbench
- Обрабатывать анимации состояния по умолчанию без необходимости использования других плагинов (ходьба, бездействие,
  смерть,
  атака, спавн)

### Как добавить существующую модель?

Чтобы импортировать модель, просто перетащите файл .bbmodel в папку imports и выполните команду `/fmm reload`. Это
сгенерирует файл .fmmodel в папке `models` и добавит модель в ресурспак в папке `outputs`.

***Вам нужно будет использовать этот ресурспак, чтобы правильно просматривать модель!*** Это обычный ресурспак, поэтому
все, что вам нужно сделать, это поместить его в папку с ресурспаками. Серверы Minecraft имеют способ размещать
ресурспаки на сторонних сервисах, таких как Google Drive или специализированный сервис, например
https://resourcepack.host/. Последний веб-сайт может быть самым простым способом это сделать.

### Как просмотреть модель в игре?

Есть две (запланированные) категории моделей.

- `Статические` модели предназначены для моделей, которые не двигаются (но могут иметь анимацию), и служат скорее как
  украшения - что-то вроде фонарного столба или рождественской елки.
- `Динамические` модели предназначены для моделей, которые ведут себя как мобы Minecraft, то есть они перемещаются и
  выполняют различные действия, связанные с мобами. Подумайте о таких моделях, как пользовательские модели боссов или
  добавление совершенно новых типов сущностей в Minecraft.

#### Просмотр статических моделей в игре

Чтобы просмотреть статические модели в игре, используйте команду `/fmm spawn static <id>`, где id - это имя файла модели
в нижнем регистре и без расширения файла.

#### Просмотр динамических моделей в игре

Чтобы просмотреть динамические модели в игре, используйте команду `/fmm spawn dynamic <id>`, где id - это имя файла
модели в нижнем регистре и без расширения файла.

## Что FreeMinecraftModels (FMM) может сделать для моделлеров?

FMM соблюдает стандартные правила генерации ресурспаков. Кроме того, он старается быть максимально совместимым с
моделями, совместимыми с ModelEngine, чтобы попытаться стандартизировать создание моделей между плагинами.

### Особенности / ограничения генерации моделей

Если вы когда-либо создавали модели для ModelEngine, вам будут знакомы многие ограничения генерации ресурспаков
Minecraft:

#### **Кубы:**

Кубы здесь такие же, как и в Blockbench, это кубы, из которых состоит модель.

- Кубы могут достигать размера до ~~112x112x112~~ 106x106x106 "пикселей" (единицы Blockbench) или 7x7x7 игровых блоков
  (обычные ограничения Minecraft обойдены с помощью размеров отображения, вскоре это будет еще больше обойдено для
  версии 1.19.4+ благодаря сущностям отображения)
- Допустимые повороты для кубов: 0, 22.5, -22.5, 45 и -45. Никакой другой поворот не работает.
- Кубы вращаются только в одной оси, то есть поворот [22.5, 0, 0] является допустимым, поворот [22.5, 0, 45] не будет
  полностью работать и будет вращаться только в одной оси.

#### **Кости:**

Кости - это то, что Blockbench называет "группами". Они служат для группировки кубов вместе и должны использоваться для
группировки костей для анимации.

- Кости могут достигать размера до ~~112x112x112~~ 106x106x106 (должно быть 112, не уверен, почему так) "пикселей" (
  единицы
  Blockbench) или 7x7x7 игровых блоков. *Обратите внимание, что размер костей определяется тем, что они содержат,
  поэтому,
  если у вас есть кубы, которые находятся на расстоянии более 7 блоков друг от друга, вы, вероятно, превысите это
  ограничение размера. Обойти это ограничение так же просто, как поместить блоки в другую кость, не входящую в первую!*
- Могут иметь любой поворот!

Кости значительно более гибкие, чем кубы, но вы должны использовать как можно меньше костей! В FMM, из-за ограничений
Minecraft, каждая кость является отдельной сущностью. В масштабе это довольно быстро скажется на производительности!
Всегда
используйте как можно меньше костей и помните о том, сколько моделей вы планируете заспавнить - чем больше их вы
планируете
иметь, тем меньше костей у них должно быть!

#### **Виртуальные кости**

Если вы пришли из ModelEngine, вам, вероятно, интересно, реализованы ли/как виртуальные кости в FMM. Виртуальные кости
были выделены, но в настоящее время не реализованы, за исключением очень простой основы.

Однако, по крайней мере, следующие виртуальные кости скоро будут совместимы с FMM:

- Хитбоксы / высота глаз: кость с именем "hitbox" и кубом, определяющим границы, и имеющим одинаковые значения x и z
  (будет выбрано наибольшее значение, если они не совпадают), определяет хитбокс. Уровень глаз устанавливается в точке
  поворота кости хитбокса.
- Имя: кость, имя которой начинается с "tag_". Честно говоря, я бы предпочел быть более конкретным и использовать
  "tag_name", чтобы использовать теги для других целей, но это будет серьезно рассмотрено позже.

Нет никакой гарантии, что в ближайшем будущем будут добавлены другие возможности виртуальных костей.

## Объединение ресурспаков

При использовании FMM вам, вероятно, потребуется объединять ресурспаки.

Вы можете объединять ресурспаки вручную, но мы рекомендуем использовать онлайн-инструмент, такой
как [merge.elmakers](https://merge.elmakers.com/),
для объединения ваших ресурспаков.

#### **Более безопасное, простое, нередактируемое распространение файлов**

Одна из проблем, которую FMM пытается решить, - это пользователи, перепрофилирующие полученные ими модели для
редактирования
способами, которые создатель модели не хотел, чтобы они редактировали, особенно с целью перекрасить или иным образом
немного изменить модель и потенциально попытаться перепродать как оригинальное творение.

С этой целью FMM использует формат файла `.fmmodel`, который направлен на то, чтобы уменьшить файлы `.bbmodel` до такой
степени, что они могут использоваться плагином, но не могут быть отредактированы в Blockbench.

Теперь у модельера есть выбор, хотите ли вы выпустить нередактируемый файл `.fmmodel`, редактируемый файл `.bbmodel` или
даже установить дифференцированное ценообразование или условия распространения для этих двух файлов.

Создание `.fmmodel` так же просто, как поместить файл `.bbmodel` в папку `~/plugins/FreeMinecraftModels/imports` и
перезагрузить плагин командой `/fmm reload` или перезапустить сервер. Ваш `.fmmodel` будет находиться в папке
`~/plugins/FreeMinecraftModels/models`.

## Что FreeMinecraftModels (FMM) может сделать для разработчиков, которые хотят интегрировать его в свои плагины?

У FMM есть репозиторий maven!
Maven:

```xml
<repository>
    <id>ossrh-public</id>
    <url>https://s01.oss.sonatype.org/content/groups/snapshots/</url>
</repository>

<dependency>
<groupId>com.magmaguy</groupId>
<artifactId>FreeMinecraftModels</artifactId>
<version>1.1.3-SNAPSHOT</version>
<scope>provided</scope>
</dependency>
```

Gradle:

```kotlin
compileOnly group : 'com.magmaguy', name: 'FreeMinecraftModels', version: '1.1.2-SNAPSHOT'
```

*Обратите внимание, что FreeMinecraftModels предназначен для использования в качестве API и потребует установки плагина
на сервер. Не включайте его в свой плагин!*

FMM стремится быть максимально простым в использовании в качестве API.

Прямо сейчас есть только один класс, о котором вам нужно знать, если вы хотите использовать FMM в качестве API для
своего
плагина, и это `StaticEntity`.

Вот фрагмент для обработки статической модели:

```java
public class FreeMinecraftModelsModel {
    private StaticEntity staticEntity = null;

    //Создание модели
    public FreeMinecraftModelsModel(String id, Location location) {
        //Это спавнит сущность!
        staticEntity = StaticEntity.create(id, location);
        //Это проверяет, правильно ли заспавнилась сущность
        if (staticEntity == null) Logger.warningMessage("FMM не удалось найти модель с именем " + id + " !");
    }

    public void remove() {
        //Это удаляет сущность
        staticEntity.remove();
    }
}
```

Имейте в виду, что статические модели предназначены для того, чтобы оставаться на месте и действовать как декоративный
элемент в фиксированном месте (анимации не считаются "движением"). Хотя их можно перемещать, подумайте, не лучше ли
использовать динамическую модель, если это ваша цель.

И вот как EliteMobs, мой плагин для пользовательских боссов, использует динамические сущности:

```java
package com.magmaguy.elitemobs.thirdparty.custommodels.freeminecraftmodels;

import com.magmaguy.elitemobs.mobconstructor.custombosses.CustomBossEntity;
import com.magmaguy.elitemobs.thirdparty.custommodels.CustomModelInterface;
import com.magmaguy.freeminecraftmodels.api.ModeledEntityManager;
import com.magmaguy.freeminecraftmodels.customentity.DynamicEntity;
import lombok.Getter;
import org.bukkit.entity.LivingEntity;

public class CustomModelFMM implements CustomModelInterface {
    @Getter
    private DynamicEntity dynamicEntity;

    public CustomModelFMM(LivingEntity livingEntity, String modelName, String nametagName) {
        dynamicEntity = DynamicEntity.create(modelName, livingEntity);
        if (dynamicEntity == null) return;
        dynamicEntity.setName(nametagName);
    }

    public static void reloadModels() {
        ModeledEntityManager.reload();
    }

    public static boolean modelExists(String modelName) {
        return ModeledEntityManager.modelExists(modelName);
    }

    @Override
    public void shoot() {
        if (dynamicEntity.hasAnimation("attack_ranged")) dynamicEntity.playAnimation("attack_ranged", false);
        else dynamicEntity.playAnimation("attack", false);
    }

    @Override
    public void melee() {
        if (dynamicEntity.hasAnimation("attack_melee")) dynamicEntity.playAnimation("attack_melee", false);
        else dynamicEntity.playAnimation("attack", false);
    }

    @Override
    public void playAnimationByName(String animationName) {
        dynamicEntity.playAnimation(animationName, false);
    }

    @Override
    public void setName(String nametagName, boolean visible) {
        dynamicEntity.setName(nametagName);
        dynamicEntity.setNameVisible(visible);
    }

    @Override
    public void setNameVisible(boolean visible) {
        dynamicEntity.setNameVisible(visible);
    }

    @Override
    public void switchPhase() {
        dynamicEntity.stopCurrentAnimations();
    }
}
```

Динамические модели построены на основе живой сущности, которая может быть предоставлена либо при использовании метода
create, как в примере выше, либо при запуске метода spawn для динамической сущности.

Хотя сейчас нет формального ресурса API, все элементы, предназначенные для использования API, содержатся в ModeledEntity
(базовый класс для всех сущностей), StaticEntity, DynamicEntity и ModeledEntityManager. 99% разработчиков найдут все
необходимые им методы в этих трех классах.

# Вклад в проект FreeMinecraftModels (FMM) в качестве разработчика

FMM распространяется под лицензией GPLV3, и приветствуются вклады в код. Вот основные правила внесения вклада:

- Следуйте существующим соглашениям об именах, поддерживайте существующий уровень многословности и добавляйте достаточно
  документации, чтобы ваш вклад был легко понятен.
- Сохраняйте вклад актуальным для области действия плагина. Если вы не знаете, будет ли это актуально, не стесняйтесь
  спросить заранее.
- Помните о влиянии вашего кода на производительность. Некоторые вклады могут быть отклонены, если они слишком
  неоптимизированы или иным образом вызывают слишком большое влияние на производительность.

## Общая схема плагина

Чтобы сэкономить ваше время, вот краткое описание логического потока FMM:

1) Чтение папки `imports`.
2) Перемещение файлов из папки `imports` в папку `models`. Если файл имеет формат `.bbmodel`, он преобразуется
   в `.fmmodel`
   в папке models.
3) Чтение файлов в папке `models`.
4) Интерпретация всех структур модели, создание `Skeleton`, которые содержат группы `Bone`, а эти кости содержат группы
   дочерних `Bone` и `Cube`. `Cube` и `Bone` генерируют данные JSON ресурспака, к которым они относятся. Это означает,
   что
   `Cube` генерируют JSON, специфичный для кубов, а `Bone` генерируют контур и отдельные файлы костей. Обратите
   внимание,
   что одна кость приводит к одному файлу ресурспака. Модели добавляются в список по мере их генерации.
5) Все еще в `Skeleton`, интерпретируются все `Animations` в модели, если таковые имеются.
6) Все данные теперь инициализированы, ресурспак сгенерирован в папке `outputs`, и плагин готов к использованию.

## Трюки, используемые в этом плагине:

Используемые здесь трюки довольно хорошо устоялись и стандартизированы, но все же будут перечислены, поскольку они могут
быть нелогичными.

Обратите внимание, что все эти трюки совершенно невидимы для пользователей и создателей моделей; ограничения и обходные
пути перечислены только для того, чтобы помочь вам понять, как FMM обходит различные ограничения Minecraft.

- Все модели увеличиваются в 4 раза, а затем размер и точка поворота перенастраиваются в коде, чтобы увеличить
  теоретический максимальный размер модели.
- Поскольку модели ресурспака могут иметь размер только от -16 до +32, модели смещаются в фоновом режиме. Это совершенно
  невидимо для игроков.
- Для создания моделей с оттенком, на который можно влиять с помощью кода (например, для индикации повреждений),
  используется кожаная конская броня. Для отображения правильных цветов конская броня должна быть установлена в белый
  цвет!
- Blockbench использует определенную систему идентификаторов для текстур, но фактически считывает текстуры
  последовательно из конфигурации. Здесь идентификаторы назначаются на основе их положения в списке текстур, следуя
  тому,
  как это делает Blockbench.
- Каждая кость является отдельной сущностью бронестойки из-за ограничений Minecraft.
- Кожаная конская броня находится в слоте для головы бронестойки.
- Бронестойки используются для статических элементов по умолчанию. //todo: скоро мне нужно будет реализовать новую
  альтернативную систему отображения из MC 1.19.4+, она намного эффективнее.
- Чтобы избежать конфликтов с другими плагинами, которые модифицируют кожаную конскую броню, FMM использует
  пользовательские
  значения данных модели, начиная с 50 000.

# Вклад в проект FreeMinecraftModels (FMM) в целом

FMM фактически финансируется замечательными людьми
на [https://www.patreon.com/magmaguy](https://www.patreon.com/magmaguy)!
Все вклады помогают больше, чем вы можете себе представить ;)

# Запланированные в настоящее время функции:

- Генерация RSP для клиентов Bedrock.
- Независимое от свойств сервера управление RSP с интеграцией Geyser.
- Пользовательские сущности (?).
- tag_projectile как мета-кости, из которых можно стрелять снарядами (может быть более одной на модель).

# Текущие странные ограничения, которые необходимо исправить:

- Если точка поворота (начало координат) кости установлена выше 67, модель начинает плавать.
